import os
import django
import sys

project_path = os.path.dirname(os.path.abspath(__file__))
sys.path.append(project_path)

os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'techno_work.settings')
django.setup()

from career_app.models import Category, Vacancy, Internship


def migrate_to_hierarchical_categories():
    """–ú–∏–≥—Ä–∏—Ä—É–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ –∫ –Ω–æ–≤–æ–π –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π"""

    # –°–ª–æ–≤–∞—Ä—å –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏ —Å—Ç–∞—Ä—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∫ –Ω–æ–≤—ã–º –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
    migration_map = {
        '–ü—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç': '–ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ',
        '–í–µ–±-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫': '–í–µ–±-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞',
        '–ú–æ–±–∏–ª—å–Ω—ã–π —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫': '–ú–æ–±–∏–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞',
        'Data Scientist': 'Data Science',
        'DevOps': 'DevOps',
        '–¢–µ—Å—Ç–∏—Ä–æ–≤—â–∏–∫ (QA)': '–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (QA)',
        '–°–∏—Å—Ç–µ–º–Ω—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä': 'DevOps',
        '–ê–Ω–∞–ª–∏—Ç–∏–∫ –¥–∞–Ω–Ω—ã—Ö': 'Data Science',
        '–í–µ–±-–¥–∏–∑–∞–π–Ω–µ—Ä': '–í–µ–±-–¥–∏–∑–∞–π–Ω',
        '–ì—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π –¥–∏–∑–∞–π–Ω–µ—Ä': '–ì—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π –¥–∏–∑–∞–π–Ω',
        'UI/UX –¥–∏–∑–∞–π–Ω–µ—Ä': 'UI/UX –¥–∏–∑–∞–π–Ω',
        '3D-–¥–∏–∑–∞–π–Ω–µ—Ä': '3D-–¥–∏–∑–∞–π–Ω',
        '–ú–∞—Ä–∫–µ—Ç–æ–ª–æ–≥': '–¶–∏—Ñ—Ä–æ–≤–æ–π –º–∞—Ä–∫–µ—Ç–∏–Ω–≥',
        'SMM-—Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç': 'SMM',
        '–ö–æ–ø–∏—Ä–∞–π—Ç–µ—Ä': '–ö–æ–Ω—Ç–µ–Ω—Ç-–º–∞—Ä–∫–µ—Ç–∏–Ω–≥',
        '–ü—Ä–æ–¥–∞–≤–µ—Ü': '–ü—Ä–æ–¥–∞–∂–∏',
        '–ú–µ–Ω–µ–¥–∂–µ—Ä –ø–æ –ø—Ä–æ–¥–∞–∂–∞–º': '–ü—Ä–æ–¥–∞–∂–∏',
        '–¢–æ—Ä–≥–æ–≤—ã–π –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª—å': '–¢–æ—Ä–≥–æ–≤—ã–π –ø–µ—Ä—Å–æ–Ω–∞–ª',
        '–ü—Ä–æ–µ–∫—Ç–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä': '–ü—Ä–æ–µ–∫—Ç–Ω—ã–π –º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç',
        '–ü—Ä–æ–¥—É–∫—Ç–æ–≤—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä': '–ü—Ä–æ–¥—É–∫—Ç–æ–≤—ã–π –º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç',
        '–û—Ñ–∏—Å-–º–µ–Ω–µ–¥–∂–µ—Ä': '–û—Ñ–∏—Å-–º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç',
        'HR-–º–µ–Ω–µ–¥–∂–µ—Ä': 'HR',
        '–ë—É—Ö–≥–∞–ª—Ç–µ—Ä': '–ë—É—Ö–≥–∞–ª—Ç–µ—Ä–∏—è',
        '–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –∞–Ω–∞–ª–∏—Ç–∏–∫': '–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –∞–Ω–∞–ª–∏–∑',
        '–≠–∫–æ–Ω–æ–º–∏—Å—Ç': '–≠–∫–æ–Ω–æ–º–∏–∫–∞',
        '–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å': '–ü—Ä–µ–ø–æ–¥–∞–≤–∞–Ω–∏–µ',
        '–£—á–µ–Ω—ã–π': '–ù–∞—É—á–Ω—ã–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è',
        '–õ–∞–±–æ—Ä–∞–Ω—Ç': '–ù–∞—É—á–Ω—ã–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è',
        '–í—Ä–∞—á': '–ú–µ–¥–∏—Ü–∏–Ω–∞',
        '–ú–µ–¥—Å–µ—Å—Ç—Ä–∞/–º–µ–¥–±—Ä–∞—Ç': '–ú–µ–¥–∏—Ü–∏–Ω–∞',
        '–§–∞—Ä–º–∞—Ü–µ–≤—Ç': '–§–∞—Ä–º–∞—Ü–µ–≤—Ç–∏–∫–∞',
        '–í–æ–¥–∏—Ç–µ–ª—å': '–í–æ–¥–∏—Ç–µ–ª–∏',
        '–õ–æ–≥–∏—Å—Ç': '–õ–æ–≥–∏—Å—Ç–∏–∫–∞',
        '–ö—É—Ä—å–µ—Ä': '–ö—É—Ä—å–µ—Ä—Å–∫–∏–µ —É—Å–ª—É–≥–∏',
        '–ò–Ω–∂–µ–Ω–µ—Ä': '–ò–Ω–∂–µ–Ω–µ—Ä–∏—è',
        '–¢–µ—Ö–Ω–∏–∫': '–ò–Ω–∂–µ–Ω–µ—Ä–∏—è',
        '–°—Ç—Ä–æ–∏—Ç–µ–ª—å': '–°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ',
        '–ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä': '–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞',
        '–ü–æ–≤–∞—Ä': '–†–µ—Å—Ç–æ—Ä–∞–Ω–Ω—ã–π –±–∏–∑–Ω–µ—Å',
        '–û—Ñ–∏—Ü–∏–∞–Ω—Ç': '–†–µ—Å—Ç–æ—Ä–∞–Ω–Ω—ã–π –±–∏–∑–Ω–µ—Å',
        '–ë–∞—Ä–∏—Å—Ç–∞': '–†–µ—Å—Ç–æ—Ä–∞–Ω–Ω—ã–π –±–∏–∑–Ω–µ—Å',
        '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä': '–û—Ñ–∏—Å-–º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç',
        '–Æ—Ä–∏—Å—Ç': '–Æ—Ä–∏—Å–ø—Ä—É–¥–µ–Ω—Ü–∏—è',
        '–ü–µ—Ä–µ–≤–æ–¥—á–∏–∫': '–ü–µ—Ä–µ–≤–æ–¥—ã',
        '–ñ—É—Ä–Ω–∞–ª–∏—Å—Ç': '–ñ—É—Ä–Ω–∞–ª–∏—Å—Ç–∏–∫–∞',
        '–§–æ—Ç–æ–≥—Ä–∞—Ñ': '–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è',
        '–í–∏–¥–µ–æ–≥—Ä–∞—Ñ': '–í–∏–¥–µ–æ–ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ',
    }

    # –ú–∏–≥—Ä–∏—Ä—É–µ–º –≤–∞–∫–∞–Ω—Å–∏–∏
    vacancies_updated = 0
    for vacancy in Vacancy.objects.all():
        if vacancy.category and vacancy.category.name in migration_map:
            new_category_name = migration_map[vacancy.category.name]
            try:
                new_category = Category.objects.get(name=new_category_name)
                vacancy.category = new_category
                vacancy.save()
                vacancies_updated += 1
                print(f"‚úÖ –í–∞–∫–∞–Ω—Å–∏—è '{vacancy.title}' –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏—é '{new_category_name}'")
            except Category.DoesNotExist:
                print(f"‚ùå –ö–∞—Ç–µ–≥–æ—Ä–∏—è '{new_category_name}' –Ω–µ –Ω–∞–π–¥–µ–Ω–∞")

    # –ú–∏–≥—Ä–∏—Ä—É–µ–º —Å—Ç–∞–∂–∏—Ä–æ–≤–∫–∏
    internships_updated = 0
    for internship in Internship.objects.all():
        if internship.category and internship.category.name in migration_map:
            new_category_name = migration_map[internship.category.name]
            try:
                new_category = Category.objects.get(name=new_category_name)
                internship.category = new_category
                internship.save()
                internships_updated += 1
                print(f"‚úÖ –°—Ç–∞–∂–∏—Ä–æ–≤–∫–∞ '{internship.title}' –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏—é '{new_category_name}'")
            except Category.DoesNotExist:
                print(f"‚ùå –ö–∞—Ç–µ–≥–æ—Ä–∏—è '{new_category_name}' –Ω–µ –Ω–∞–π–¥–µ–Ω–∞")

    print(f"\nüéØ –ú–∏–≥—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞!")
    print(f"üìä –û–±–Ω–æ–≤–ª–µ–Ω–æ –≤–∞–∫–∞–Ω—Å–∏–π: {vacancies_updated}")
    print(f"üìä –û–±–Ω–æ–≤–ª–µ–Ω–æ —Å—Ç–∞–∂–∏—Ä–æ–≤–æ–∫: {internships_updated}")


if __name__ == '__main__':
    migrate_to_hierarchical_categories()