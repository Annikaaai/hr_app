{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-md-10 mx-auto">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0">üíº –°–æ–∑–¥–∞–Ω–∏–µ –∏–¥–µ–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è –≤–∞–∫–∞–Ω—Å–∏–∏</h4>
                </div>
                <div class="card-body">
                    <p class="text-muted mb-4">
                        –û–ø–∏—à–∏—Ç–µ –∏–¥–µ–∞–ª—å–Ω—É—é —Ä–∞–±–æ—Ç—É, –∏ –Ω–∞—à–∞ –ò–ò-—Å–∏—Å—Ç–µ–º–∞ –Ω–∞–π–¥–µ—Ç –ª—É—á—à–∏–µ –≤–∞–∫–∞–Ω—Å–∏–∏
                        –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–º—ã—Å–ª–æ–≤–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞.
                    </p>

                    <form method="post" id="vacancyProfileForm">
                        {% csrf_token %}

                        <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">{{ form.title.label }}</label>
                                    {{ form.title }}
                                    {% if form.title.errors %}
                                    <div class="text-danger">
                                        {% for error in form.title.errors %}
                                        <small>{{ error }}</small>
                                        {% endfor %}
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="mb-3">
                                    <label class="form-label">{{ form.min_match_percentage.label }}</label>
                                    {{ form.min_match_percentage }}
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="mb-3">
                                    <label class="form-label">{{ form.max_vacancies.label }}</label>
                                    {{ form.max_vacancies }}
                                </div>
                            </div>
                        </div>

                        <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">{{ form.main_category.label }}</label>
                                    {{ form.main_category }}
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">{{ form.subcategory.label }}</label>
                                    {{ form.subcategory }}
                                </div>
                            </div>
                        </div>

                        <!-- –î–æ–ª–∂–Ω–æ—Å—Ç—å –∏ –Ω–∞–≤—ã–∫–∏ -->
                        <div class="mb-4">
                            <label class="form-label">{{ form.ideal_position.label }}</label>
                            {{ form.ideal_position }}
                        </div>

                        <!-- –ù–∞–≤—ã–∫–∏ (–ø–æ—è–≤—è—Ç—Å—è –ø–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏) -->
                        <div class="mb-4" id="skills-section" style="display: none;">
                            <label class="form-label">{{ form.selected_skill_tags.label }}</label>
                            <div class="form-text">{{ form.selected_skill_tags.help_text }}</div>
                            <div id="skills-container" class="mt-2 p-3 border rounded">
                                <!-- –ù–∞–≤—ã–∫–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ AJAX -->
                            </div>
                            {% if form.selected_skill_tags.errors %}
                            <div class="text-danger">
                                {% for error in form.selected_skill_tags.errors %}
                                <small>{{ error }}</small>
                                {% endfor %}
                            </div>
                            {% endif %}
                        </div>

                        <!-- –û–ø—ã—Ç –∏ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ -->
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">{{ form.experience_level.label }}</label>
                                    {{ form.experience_level }}
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">{{ form.education_level.label }}</label>
                                    {{ form.education_level }}
                                </div>
                            </div>
                        </div>

                        <!-- –£—Å–ª–æ–≤–∏—è —Ä–∞–±–æ—Ç—ã -->
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">{{ form.employment_types.label }}</label>
                                    <div class="form-text">{{ form.employment_types.help_text }}</div>
                                    {{ form.employment_types }}
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">{{ form.work_schedule.label }}</label>
                                    <div class="form-text">{{ form.work_schedule.help_text }}</div>
                                    {{ form.work_schedule }}
                                </div>
                            </div>
                        </div>

                        <!-- –ó–∞—Ä–ø–ª–∞—Ç–∞ –∏ –ª–æ–∫–∞—Ü–∏—è -->
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">{{ form.desired_salary.label }}</label>
                                    {{ form.desired_salary }}
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">{{ form.location_preferences.label }}</label>
                                    {{ form.location_preferences }}
                                </div>
                            </div>
                        </div>

                        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                            <a href="{% url 'ai_search_dashboard' %}" class="btn btn-secondary me-md-2">–û—Ç–º–µ–Ω–∞</a>
                            <button type="submit" class="btn btn-primary">
                                {% if form.instance.pk %}üîÑ –û–±–Ω–æ–≤–∏—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø–æ–∏—Å–∫{% else %}üíº –ó–∞–ø—É—Å—Ç–∏—Ç—å —É–º–Ω—ã–π –ø–æ–∏—Å–∫ –≤–∞–∫–∞–Ω—Å–∏–π{% endif %}
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- –ü–æ–¥—Å–∫–∞–∑–∫–∏ -->
            <div class="card mt-4">
                <div class="card-body">
                    <h5>üí° –°–æ–≤–µ—Ç—ã –ø–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—é:</h5>
                    <ul class="text-muted">
                        <li>–ù–∞—á–Ω–∏—Ç–µ —Å –≤—ã–±–æ—Ä–∞ –æ—Å–Ω–æ–≤–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ - —ç—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç –ø–æ–ª—É—á–∏—Ç—å —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –Ω–∞–≤—ã–∫–∏</li>
                        <li>–í—ã–±–∏—Ä–∞–π—Ç–µ —Ç–æ–ª—å–∫–æ —Å–∞–º—ã–µ –≤–∞–∂–Ω—ã–µ –¥–ª—è –≤–∞—Å –Ω–∞–≤—ã–∫–∏ (–¥–æ 10 —à—Ç—É–∫)</li>
                        <li>–ß–µ–º —Ç–æ—á–Ω–µ–µ –≤—ã –æ–ø–∏—à–µ—Ç–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è, —Ç–µ–º –ª—É—á—à–µ –±—É–¥—É—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞</li>
                        <li>–ò–ò —É—á–∏—Ç—ã–≤–∞–µ—Ç –≤—Å–µ —É–∫–∞–∑–∞–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—Ä–∏ –ø–æ–∏—Å–∫–µ –≤–∞–∫–∞–Ω—Å–∏–π</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- JavaScript –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏ –Ω–∞–≤—ã–∫–æ–≤ -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const mainCategorySelect = document.getElementById('id_main_category');
    const subcategorySelect = document.getElementById('id_subcategory');
    const skillsSection = document.getElementById('skills-section');
    const skillsContainer = document.getElementById('skills-container');

    // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –æ—Å–Ω–æ–≤–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    mainCategorySelect.addEventListener('change', function() {
        const mainCategoryId = this.value;

        if (mainCategoryId) {
            fetch(`/career/ajax/get-subcategories/?main_category_id=${mainCategoryId}`)
                .then(response => response.json())
                .then(data => {
                    subcategorySelect.innerHTML = '<option value="">--- –í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—é ---</option>';
                    data.subcategories.forEach(subcat => {
                        const option = document.createElement('option');
                        option.value = subcat.id;
                        option.textContent = subcat.name;
                        subcategorySelect.appendChild(option);
                    });
                    skillsSection.style.display = 'none';
                });
        } else {
            subcategorySelect.innerHTML = '<option value="">--- –°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –æ—Å–Ω–æ–≤–Ω—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é ---</option>';
            skillsSection.style.display = 'none';
        }
    });

    // –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞–≤—ã–∫–æ–≤ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    subcategorySelect.addEventListener('change', function() {
        const subcategoryId = this.value;

        if (subcategoryId) {
            fetch(`/career/ajax/get-skills/?subcategory_id=${subcategoryId}`)
                .then(response => response.json())
                .then(data => {
                    skillsContainer.innerHTML = '';
                    if (data.skills.length > 0) {
                        data.skills.forEach(skill => {
                            const checkbox = document.createElement('div');
                            checkbox.className = 'form-check';
                            checkbox.innerHTML = `
                                <input class="form-check-input" type="checkbox" name="selected_skill_tags"
                                       value="${skill.id}" id="skill_${skill.id}">
                                <label class="form-check-label" for="skill_${skill.id}">
                                    ${skill.name}
                                </label>
                            `;
                            skillsContainer.appendChild(checkbox);
                        });
                        skillsSection.style.display = 'block';
                    } else {
                        skillsContainer.innerHTML = '<p class="text-muted">–î–ª—è —ç—Ç–æ–π –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ–∫–∞ –Ω–µ—Ç –Ω–∞–≤—ã–∫–æ–≤</p>';
                        skillsSection.style.display = 'block';
                    }
                });
        } else {
            skillsSection.style.display = 'none';
        }
    });

    // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –≤—ã–±–æ—Ä–∞ –Ω–∞–≤—ã–∫–æ–≤ –¥–æ 10
    skillsContainer.addEventListener('change', function(e) {
        if (e.target.type === 'checkbox') {
            const checkedSkills = skillsContainer.querySelectorAll('input[type="checkbox"]:checked');
            if (checkedSkills.length > 10) {
                e.target.checked = false;
                alert('–ú–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –Ω–µ –±–æ–ª–µ–µ 10 –Ω–∞–≤—ã–∫–æ–≤');
            }
        }
    });
});
</script>

<style>
.skill-tags-checkbox {
    max-height: 200px;
    overflow-y: auto;
    border: 1px solid #dee2e6;
    border-radius: 0.375rem;
    padding: 10px;
}

.form-check {
    margin-bottom: 0.5rem;
}

.employment-checkbox, .schedule-checkbox {
    border: 1px solid #dee2e6;
    border-radius: 0.375rem;
    padding: 10px;
    max-height: 150px;
    overflow-y: auto;
}
</style>
{% endblock %}