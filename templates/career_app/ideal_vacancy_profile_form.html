{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-md-10 mx-auto">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0">üíº –°–æ–∑–¥–∞–Ω–∏–µ –∏–¥–µ–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è –≤–∞–∫–∞–Ω—Å–∏–∏</h4>
                </div>
                <div class="card-body">
                    <p class="text-muted mb-4">
                        –û–ø–∏—à–∏—Ç–µ –∏–¥–µ–∞–ª—å–Ω—É—é —Ä–∞–±–æ—Ç—É, –∏ –Ω–∞—à–∞ –ò–ò-—Å–∏—Å—Ç–µ–º–∞ –Ω–∞–π–¥–µ—Ç –ª—É—á—à–∏–µ –≤–∞–∫–∞–Ω—Å–∏–∏
                        –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–º—ã—Å–ª–æ–≤–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞.
                    </p>

                    <form method="post" id="vacancyProfileForm">
                        {% csrf_token %}

                        <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">{{ form.title.label }} *</label>
                                    {{ form.title }}
                                    {% if form.title.errors %}
                                    <div class="text-danger">
                                        {% for error in form.title.errors %}
                                        <small>{{ error }}</small>
                                        {% endfor %}
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="mb-3">
                                    <label class="form-label">{{ form.min_match_percentage.label }} *</label>
                                    {{ form.min_match_percentage }}
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="mb-3">
                                    <label class="form-label">{{ form.max_vacancies.label }} *</label>
                                    {{ form.max_vacancies }}
                                </div>
                            </div>
                        </div>

                        <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">{{ form.main_category.label }} *</label>
                                    {{ form.main_category }}
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">{{ form.subcategory.label }} *</label>
                                    {{ form.subcategory }}
                                </div>
                            </div>
                        </div>

                        <!-- –û–ø—ã—Ç –∏ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ -->
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">{{ form.experience_level.label }} *</label>
                                    {{ form.experience_level }}
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">{{ form.education_level.label }} *</label>
                                    {{ form.education_level }}
                                </div>
                            </div>
                        </div>

                        <!-- –°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π -->
                        <div class="mb-4">
                            <label class="form-label">{{ form.tech_stack.label }}</label>
                            {{ form.tech_stack }}
                            <div class="form-text">{{ form.tech_stack.help_text }}</div>
                        </div>

                        <!-- –ó–∞—Ä–ø–ª–∞—Ç–∞ –∏ –ª–æ–∫–∞—Ü–∏—è -->
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">{{ form.desired_salary.label }}</label>
                                    {{ form.desired_salary }}
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">{{ form.location_preferences.label }}</label>
                                    {{ form.location_preferences }}
                                </div>
                            </div>
                        </div>

                        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                            <a href="{% url 'ai_search_dashboard' %}" class="btn btn-secondary me-md-2">–û—Ç–º–µ–Ω–∞</a>
                            <button type="submit" class="btn btn-primary">
                                {% if form.instance.pk %}üîÑ –û–±–Ω–æ–≤–∏—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø–æ–∏—Å–∫{% else %}üíº –ó–∞–ø—É—Å—Ç–∏—Ç—å —É–º–Ω—ã–π –ø–æ–∏—Å–∫ –≤–∞–∫–∞–Ω—Å–∏–π{% endif %}
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- –ü–æ–¥—Å–∫–∞–∑–∫–∏ -->
            <div class="card mt-4">
                <div class="card-body">
                    <h5>üí° –°–æ–≤–µ—Ç—ã –ø–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—é:</h5>
                    <ul class="text-muted">
                        <li>–ù–∞—á–Ω–∏—Ç–µ —Å –≤—ã–±–æ—Ä–∞ –æ—Å–Ω–æ–≤–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏</li>
                        <li>–£–∫–∞–∂–∏—Ç–µ —Å—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π, —Å –∫–æ—Ç–æ—Ä—ã–º–∏ —Ö–æ—Ç–∏—Ç–µ —Ä–∞–±–æ—Ç–∞—Ç—å</li>
                        <li>–ß–µ–º —Ç–æ—á–Ω–µ–µ –≤—ã –æ–ø–∏—à–µ—Ç–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è, —Ç–µ–º –ª—É—á—à–µ –±—É–¥—É—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞</li>
                        <li>–ò–ò —É—á–∏—Ç—ã–≤–∞–µ—Ç –≤—Å–µ —É–∫–∞–∑–∞–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—Ä–∏ –ø–æ–∏—Å–∫–µ –≤–∞–∫–∞–Ω—Å–∏–π</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- –£–ø—Ä–æ—â–µ–Ω–Ω—ã–π JavaScript –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const mainCategorySelect = document.getElementById('id_main_category');
    const subcategorySelect = document.getElementById('id_subcategory');

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π
    function loadSubcategories(mainCategoryId) {
        if (mainCategoryId) {
            fetch(`{% url 'get_subcategories' %}?main_category_id=${mainCategoryId}`)
                .then(response => response.json())
                .then(data => {
                    subcategorySelect.innerHTML = '<option value="">--- –í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—é ---</option>';
                    data.subcategories.forEach(subcat => {
                        const option = document.createElement('option');
                        option.value = subcat.id;
                        option.textContent = subcat.name;
                        subcategorySelect.appendChild(option);
                    });
                })
                .catch(error => {
                    console.error('Error loading subcategories:', error);
                    subcategorySelect.innerHTML = '<option value="">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</option>';
                });
        } else {
            subcategorySelect.innerHTML = '<option value="">--- –°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –æ—Å–Ω–æ–≤–Ω—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é ---</option>';
        }
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—Å–Ω–æ–≤–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    mainCategorySelect.addEventListener('change', function() {
        const mainCategoryId = this.value;
        loadSubcategories(mainCategoryId);
    });

    // –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã, –µ—Å–ª–∏ –µ—Å—Ç—å –≤—ã–±—Ä–∞–Ω–Ω–∞—è –æ—Å–Ω–æ–≤–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è, –∑–∞–≥—Ä—É–∂–∞–µ–º –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    const initialMainCategory = mainCategorySelect.value;
    if (initialMainCategory) {
        loadSubcategories(initialMainCategory);
    }
});
</script>

<style>
.form-control:focus {
    border-color: #0d6efd;
    box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.25);
}
</style>
{% endblock %}