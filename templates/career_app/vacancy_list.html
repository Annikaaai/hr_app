{% extends 'base.html' %}
{% block content %}
<!-- Hero Section for Vacancies -->
<section class="vacancies-hero-section" style="background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 50%, #e8f5e9 100%); padding: 2rem 0; position: relative; overflow: hidden;">
    <div class="container">
        <!-- Hero Header -->
        <div class="hero-header text-center mb-4">
            <div class="hero-badge mb-3" style="display: inline-flex; align-items: center; gap: 0.5rem; background: #e8f5e8; color: #2e7d32; padding: 8px 16px; border-radius: 20px; font-size: 0.85rem; font-weight: 500;">
                <i class="fas fa-briefcase"></i>
                Карьерные возможности
            </div>
            <h1 class="hero-title" style="font-size: 2.2rem; font-weight: 700; color: #1a1a1a; margin-bottom: 1rem; line-height: 1.2;">
                Вакансии и <span style="background: linear-gradient(135deg, #4caf50 0%, #2e7d32 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">стажировки</span>
            </h1>
            <p class="hero-subtitle" style="font-size: 1.1rem; color: #666; max-width: 600px; margin: 0 auto;">
                Найдите подходящие возможности для карьерного роста в ведущих технологических компаниях
            </p>
        </div>

        <!-- Statistics Cards - Уменьшенная версия -->
        <div class="stats-cards row mb-4">
            <div class="col-md-4 mb-3">
                <div class="stat-card" style="background: white; border-radius: 16px; padding: 1.5rem; text-align: center; box-shadow: 0 5px 20px rgba(0,0,0,0.08); border: 1px solid #e9ecef; transition: all 0.3s ease;">
                    <div class="stat-icon" style="width: 50px; height: 50px; background: linear-gradient(135deg, #e8f5e8 0%, #c8e6c9 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 0.8rem; color: #4caf50; font-size: 1.3rem;">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <h3 class="stat-number" style="font-size: 1.8rem; font-weight: 800; color: #1a1a1a; margin-bottom: 0.3rem;">{{ total_count }}</h3>
                    <p class="stat-label" style="color: #666; font-weight: 500; margin: 0; font-size: 0.9rem;">Всего предложений</p>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <div class="stat-card" style="background: white; border-radius: 16px; padding: 1.5rem; text-align: center; box-shadow: 0 5px 20px rgba(0,0,0,0.08); border: 1px solid #e9ecef; transition: all 0.3s ease;">
                    <div class="stat-icon" style="width: 50px; height: 50px; background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 0.8rem; color: #1976d2; font-size: 1.3rem;">
                        <i class="fas fa-briefcase"></i>
                    </div>
                    <h3 class="stat-number" style="font-size: 1.8rem; font-weight: 800; color: #1a1a1a; margin-bottom: 0.3rem;">{{ vacancies_count }}</h3>
                    <p class="stat-label" style="color: #666; font-weight: 500; margin: 0; font-size: 0.9rem;">Вакансий</p>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <div class="stat-card" style="background: white; border-radius: 16px; padding: 1.5rem; text-align: center; box-shadow: 0 5px 20px rgba(0,0,0,0.08); border: 1px solid #e9ecef; transition: all 0.3s ease;">
                    <div class="stat-icon" style="width: 50px; height: 50px; background: linear-gradient(135deg, #e8f5e8 0%, #c8e6c9 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 0.8rem; color: #4caf50; font-size: 1.3rem;">
                        <i class="fas fa-graduation-cap"></i>
                    </div>
                    <h3 class="stat-number" style="font-size: 1.8rem; font-weight: 800; color: #1a1a1a; margin-bottom: 0.3rem;">{{ internships_count }}</h3>
                    <p class="stat-label" style="color: #666; font-weight: 500; margin: 0; font-size: 0.9rem;">Стажировок</p>
                </div>
            </div>
        </div>

        <!-- Search and Filters Card -->
        <div class="filters-card" style="background: white; border-radius: 20px; padding: 2rem; box-shadow: 0 15px 30px rgba(0,0,0,0.08); border: 1px solid #e9ecef; margin-bottom: 2rem; position: relative; overflow: visible;">
            <!-- Decorative Elements -->
            <div class="filter-bg-element element-1" style="position: absolute; top: -20px; right: -20px; width: 80px; height: 80px; background: rgba(76, 175, 80, 0.1); border-radius: 50%; animation: float 6s ease-in-out infinite;"></div>

            <!-- Search Bar -->
<div class="search-section mb-4">
    <form method="get" class="search-form" id="searchForm">
        <div class="input-group" style="position: relative;">
            <span class="input-group-icon" style="position: absolute; left: 15px; top: 50%; transform: translateY(-50%); z-index: 5; color: #6c757d; font-size: 1.1rem;">
                <i class="fas fa-search"></i>
            </span>
            <input type="text" name="q" class="form-control"
                   placeholder="Поиск по названию, описанию или компании..."
                   value="{% if query and query != 'None' %}{{ query }}{% endif %}"
                   style="padding-left: 50px; height: 55px; border-radius: 12px; border: 2px solid #e9ecef; font-size: 1rem; transition: all 0.3s ease;"
                   id="searchInput">
            <button class="btn-search" type="submit" style="background: linear-gradient(135deg, #4caf50 0%, #2e7d32 100%); border: none; color: white; padding: 0 1.5rem; border-radius: 12px; font-weight: 600; font-size: 1rem; transition: all 0.3s ease; margin-left: 0.8rem;">
                Найти
            </button>
        </div>
    </form>
</div>

            <!-- Type Filters -->
            <div class="type-filters mb-4">
                <div class="filter-buttons" style="display: flex; gap: 0.8rem; justify-content: center; flex-wrap: wrap;">
                    <button class="filter-btn {% if filter_type == 'all' %}active{% endif %}"
                            onclick="updateTypeFilter('all')"
                            style="background: {% if filter_type == 'all' %}linear-gradient(135deg, #4caf50 0%, #2e7d32 100%){% else %}white{% endif %};
                                   color: {% if filter_type == 'all' %}white{% else %}#666{% endif %};
                                   border: 2px solid #e9ecef;
                                   padding: 0.8rem 1.5rem;
                                   border-radius: 10px;
                                   font-weight: 600;
                                   transition: all 0.3s ease;
                                   display: flex;
                                   align-items: center;
                                   gap: 0.5rem;
                                   font-size: 0.9rem;">
                        <i class="fas fa-layer-group"></i>
                        Все ({{ total_count }})
                    </button>
                    <button class="filter-btn {% if filter_type == 'vacancies' %}active{% endif %}"
                            onclick="updateTypeFilter('vacancies')"
                            style="background: {% if filter_type == 'vacancies' %}linear-gradient(135deg, #1976d2 0%, #0d47a1 100%){% else %}white{% endif %};
                                   color: {% if filter_type == 'vacancies' %}white{% else %}#666{% endif %};
                                   border: 2px solid #e9ecef;
                                   padding: 0.8rem 1.5rem;
                                   border-radius: 10px;
                                   font-weight: 600;
                                   transition: all 0.3s ease;
                                   display: flex;
                                   align-items: center;
                                   gap: 0.5rem;
                                   font-size: 0.9rem;">
                        <i class="fas fa-briefcase"></i>
                        Вакансии ({{ vacancies_count }})
                    </button>
                    <button class="filter-btn {% if filter_type == 'internships' %}active{% endif %}"
                            onclick="updateTypeFilter('internships')"
                            style="background: {% if filter_type == 'internships' %}linear-gradient(135deg, #4caf50 0%, #2e7d32 100%){% else %}white{% endif %};
                                   color: {% if filter_type == 'internships' %}white{% else %}#666{% endif %};
                                   border: 2px solid #e9ecef;
                                   padding: 0.8rem 1.5rem;
                                   border-radius: 10px;
                                   font-weight: 600;
                                   transition: all 0.3s ease;
                                   display: flex;
                                   align-items: center;
                                   gap: 0.5rem;
                                   font-size: 0.9rem;">
                        <i class="fas fa-graduation-cap"></i>
                        Стажировки ({{ internships_count }})
                    </button>
                </div>
            </div>

            <!-- Category Filters -->
            <div class="category-filters">
                <h6 class="filter-title mb-3" style="color: #1a1a1a; font-weight: 600; display: flex; align-items: center; gap: 0.5rem; font-size: 0.95rem;">
                    <i class="fas fa-filter" style="color: #4caf50;"></i>
                    Фильтры по категориям
                </h6>
                <div class="categories-container" style="display: flex; flex-wrap: wrap; gap: 0.8rem;">
                    {% for main_category in main_categories %}
                    <div class="custom-dropdown" style="position: relative;">
                        <button class="category-btn dropdown-toggle"
                                onclick="toggleDropdown(this)"
                                style="background: white;
                                       border: 2px solid #e9ecef;
                                       color: #666;
                                       padding: 0.6rem 1.2rem;
                                       border-radius: 10px;
                                       font-weight: 500;
                                       transition: all 0.3s ease;
                                       display: flex;
                                       align-items: center;
                                       gap: 0.5rem;
                                       font-size: 0.9rem;">
                            <i class="fas fa-tag" style="color: #4caf50;"></i>
                            {{ main_category.name }}
                            {% if main_category.has_selected %}
                            <span class="selected-badge" style="background: #4caf50; color: white; border-radius: 50%; width: 18px; height: 18px; display: flex; align-items: center; justify-content: center; font-size: 0.65rem; font-weight: 600;">
                                {{ main_category.selected_count }}
                            </span>
                            {% endif %}
                        </button>
                        <div class="custom-dropdown-menu" style="max-height: 250px; overflow-y: auto; z-index: 1050;">
                            {% for category in all_categories %}
                            {% if category.parent and category.parent.id == main_category.id %}
                            <label class="custom-dropdown-item checkbox-item">
                                <input type="checkbox"
                                       name="category"
                                       value="{{ category.id }}"
                                       {% if category.id in selected_categories %}checked{% endif %}
                                       onchange="updateCategoryFilter(this)">
                                <span class="checkmark"></span>
                                {{ category.name }}
                            </label>
                            {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- Active Filters -->
            {% if selected_categories or query or filter_type != 'all' %}
            <div class="active-filters mt-4 pt-4" style="border-top: 1px solid #e9ecef;">
                <div class="d-flex align-items-center flex-wrap gap-2">
                    <strong class="me-2" style="color: #1a1a1a; font-size: 0.9rem;">Активные фильтры:</strong>
                    {% if query and query != 'None' %}
<span class="active-filter-badge" style="background: linear-gradient(135deg, #4caf50 0%, #2e7d32 100%); color: white; padding: 0.4rem 0.8rem; border-radius: 15px; font-size: 0.8rem; display: flex; align-items: center; gap: 0.5rem;">
    Поиск: "{{ query }}"
    <a href="#" class="text-white" style="text-decoration: none; opacity: 0.8; transition: opacity 0.3s ease;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.8'" onclick="removeSearch(event)">×</a>
</span>
{% endif %}

                    {% if filter_type != 'all' %}
                    <span class="active-filter-badge" style="background: linear-gradient(135deg, #1976d2 0%, #0d47a1 100%); color: white; padding: 0.4rem 0.8rem; border-radius: 15px; font-size: 0.8rem; display: flex; align-items: center; gap: 0.5rem;">
                        Тип: {% if filter_type == 'vacancies' %}Вакансии{% else %}Стажировки{% endif %}
                        <a href="#" class="text-white" style="text-decoration: none; opacity: 0.8; transition: opacity 0.3s ease;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.8'" onclick="removeTypeFilter(event)">×</a>
                    </span>
                    {% endif %}

                    {% for cat_id in selected_categories %}
                        {% for category in all_categories %}
                            {% if category.id == cat_id %}
                            <span class="active-filter-badge" style="background: #6c757d; color: white; padding: 0.4rem 0.8rem; border-radius: 15px; font-size: 0.8rem; display: flex; align-items: center; gap: 0.5rem;">
                                {{ category.name }}
                                <a href="#" class="text-white" style="text-decoration: none; opacity: 0.8; transition: opacity 0.3s ease;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.8'" onclick="removeCategory({{ category.id }}, event)">×</a>
                            </span>
                            {% endif %}
                        {% endfor %}
                    {% endfor %}

                    {% if selected_categories %}
                    <button type="button" class="clear-all-btn" onclick="clearAllCategories()" style="background: #dc3545; color: white; border: none; padding: 0.4rem 0.8rem; border-radius: 15px; font-size: 0.8rem; transition: all 0.3s ease; display: flex; align-items: center; gap: 0.5rem;">
                        <i class="fas fa-times"></i>
                        Очистить все
                    </button>
                    {% endif %}
                </div>
            </div>
            {% endif %}
        </div>

        <!-- Vacancies List -->
        <div class="vacancies-list">
            {% for item in page_obj %}
            <div class="vacancy-card" style="background: white; border-radius: 16px; padding: 1.5rem; box-shadow: 0 5px 20px rgba(0,0,0,0.08); border: 1px solid #e9ecef; margin-bottom: 1.2rem; transition: all 0.3s ease; position: relative; overflow: hidden;">
                <!-- Decorative Element -->
                <div class="vacancy-bg-element" style="position: absolute; top: -15px; right: -15px; width: 60px; height: 60px; background: rgba(76, 175, 80, 0.05); border-radius: 50%;"></div>

                <div class="row align-items-center">
                    <div class="col-lg-8">
                        <!-- Header -->
                        <div class="vacancy-header mb-3">
                            <div class="d-flex align-items-center flex-wrap gap-2 mb-2">
                                <h4 class="vacancy-title" style="margin: 0; font-weight: 700; color: #1a1a1a; font-size: 1.2rem;">
                                    {% if item.type == 'vacancy' %}
                                        <a href="{% url 'vacancy_detail' item.id %}" style="color: inherit; text-decoration: none; transition: color 0.3s ease;">{{ item.title }}</a>
                                    {% else %}
                                        <a href="{% url 'internship_detail' item.id %}" style="color: inherit; text-decoration: none; transition: color 0.3s ease;">{{ item.title }}</a>
                                    {% endif %}
                                </h4>
                                <span class="type-badge" style="background: {% if item.type == 'vacancy' %}linear-gradient(135deg, #1976d2 0%, #0d47a1 100%){% else %}linear-gradient(135deg, #4caf50 0%, #2e7d32 100%){% endif %}; color: white; padding: 0.3rem 0.8rem; border-radius: 12px; font-size: 0.75rem; font-weight: 600;">
                                    {% if item.type == 'vacancy' %}<i class="fas fa-briefcase me-1"></i>Вакансия{% else %}<i class="fas fa-graduation-cap me-1"></i>Стажировка{% endif %}
                                </span>
                                {% if item.category %}
                                <span class="category-badge" style="background: #6c757d; color: white; padding: 0.3rem 0.8rem; border-radius: 12px; font-size: 0.75rem; font-weight: 500;">
                                    {{ item.category.name }}
                                </span>
                                {% endif %}
                            </div>
                            <h5 class="company-name" style="color: #4caf50; font-weight: 600; margin: 0; display: flex; align-items: center; gap: 0.5rem; font-size: 1rem;">
                                <i class="fas fa-building"></i>
                                {{ item.company }}
                            </h5>
                        </div>

                        <!-- Description -->
                        <p class="vacancy-description" style="color: #666; line-height: 1.5; margin-bottom: 1.2rem; font-size: 0.95rem;">
                            {{ item.description|truncatewords:30 }}
                        </p>

                        <!-- Details -->
                        <div class="vacancy-details">
                            <div class="row">
                                {% if item.type == 'vacancy' %}
                                    {% if item.salary %}
                                    <div class="col-auto">
                                        <div class="detail-item" style="display: flex; align-items: center; gap: 0.5rem; color: #4caf50; font-weight: 600; font-size: 0.9rem;">
                                            <i class="fas fa-money-bill-wave"></i>
                                            {{ item.salary }}
                                        </div>
                                    </div>
                                    {% endif %}
                                {% else %}
                                    <div class="col-auto">
                                        <div class="detail-item" style="display: flex; align-items: center; gap: 0.5rem; color: #666; font-size: 0.9rem;">
                                            <i class="fas fa-user-graduate"></i>
                                            {{ item.specialty }}
                                        </div>
                                    </div>
                                    {% if item.student_count %}
                                    <div class="col-auto">
                                        <div class="detail-item" style="display: flex; align-items: center; gap: 0.5rem; color: #666; font-size: 0.9rem;">
                                            <i class="fas fa-users"></i>
                                            {{ item.student_count }} студентов
                                        </div>
                                    </div>
                                    {% endif %}
                                    {% if item.period %}
                                    <div class="col-auto">
                                        <div class="detail-item" style="display: flex; align-items: center; gap: 0.5rem; color: #666; font-size: 0.9rem;">
                                            <i class="fas fa-calendar"></i>
                                            {{ item.period }}
                                        </div>
                                    </div>
                                    {% endif %}
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-4 text-lg-end">
                        <div class="vacancy-actions">
                            {% if item.type == 'vacancy' %}
                                <a href="{% url 'vacancy_detail' item.id %}" class="btn-details" style="background: linear-gradient(135deg, #4caf50 0%, #2e7d32 100%); color: white; padding: 0.8rem 1.5rem; border-radius: 10px; text-decoration: none; font-weight: 600; transition: all 0.3s ease; display: inline-flex; align-items: center; gap: 0.5rem; margin-bottom: 0.8rem; font-size: 0.9rem;">
                                    <i class="fas fa-eye"></i>
                                    Подробнее
                                </a>
                            {% else %}
                                <a href="{% url 'internship_detail' item.id %}" class="btn-details" style="background: linear-gradient(135deg, #1976d2 0%, #0d47a1 100%); color: white; padding: 0.8rem 1.5rem; border-radius: 10px; text-decoration: none; font-weight: 600; transition: all 0.3s ease; display: inline-flex; align-items: center; gap: 0.5rem; margin-bottom: 0.8rem; font-size: 0.9rem;">
                                    <i class="fas fa-eye"></i>
                                    Подробнее
                                </a>
                            {% endif %}
                            <div class="vacancy-date" style="color: #999; font-size: 0.85rem;">
                                <i class="fas fa-calendar me-1"></i>
                                {{ item.created_at|date:"d.m.Y" }}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% empty %}
            <div class="no-results text-center py-5">
                <div class="no-results-icon" style="font-size: 3rem; color: #e9ecef; margin-bottom: 1.2rem;">
                    <i class="fas fa-search"></i>
                </div>
                <h4 style="color: #666; margin-bottom: 0.8rem; font-size: 1.3rem;">Ничего не найдено</h4>
                <p style="color: #999; margin-bottom: 1.5rem; font-size: 0.95rem;">
                    {% if filter_type == 'vacancies' %}
                        Нет вакансий, соответствующих вашему запросу
                    {% elif filter_type == 'internships' %}
                        Нет стажировок, соответствующих вашему запросу
                    {% else %}
                        Нет вакансий или стажировок, соответствующих вашему запросу
                    {% endif %}
                </p>
                {% if query or selected_categories or filter_type != 'all' %}
                <a href="{% url 'vacancy_list' %}" class="btn-reset" style="background: linear-gradient(135deg, #4caf50 0%, #2e7d32 100%); color: white; padding: 0.8rem 1.5rem; border-radius: 10px; text-decoration: none; font-weight: 600; transition: all 0.3s ease; display: inline-flex; align-items: center; gap: 0.5rem; font-size: 0.9rem;">
                    <i class="fas fa-refresh"></i>
                    Показать все предложения
                </a>
                {% endif %}
            </div>
            {% endfor %}
        </div>

        <!-- Pagination -->
        {% if page_obj.has_other_pages %}
        <div class="pagination-section mt-4">
            <nav aria-label="Page navigation">
                <ul class="pagination justify-content-center">
                    {% if page_obj.has_previous %}
                    <li class="page-item">
                        <a class="page-link" href="#" onclick="navigateToPage({{ page_obj.previous_page_number }}, event)" style="border: 2px solid #e9ecef; border-radius: 8px; padding: 0.6rem 1.2rem; margin: 0 0.2rem; color: #666; font-weight: 500; transition: all 0.3s ease; font-size: 0.9rem;">
                            <i class="fas fa-chevron-left me-2"></i>Назад
                        </a>
                    </li>
                    {% endif %}

                    {% for num in page_obj.paginator.page_range %}
                        {% if page_obj.number == num %}
                            <li class="page-item active">
                                <span class="page-link" style="background: linear-gradient(135deg, #4caf50 0%, #2e7d32 100%); border: none; border-radius: 8px; padding: 0.6rem 1.2rem; margin: 0 0.2rem; color: white; font-weight: 600; font-size: 0.9rem;">
                                    {{ num }}
                                </span>
                            </li>
                        {% else %}
                            <li class="page-item">
                                <a class="page-link" href="#" onclick="navigateToPage({{ num }}, event)" style="border: 2px solid #e9ecef; border-radius: 8px; padding: 0.6rem 1.2rem; margin: 0 0.2rem; color: #666; font-weight: 500; transition: all 0.3s ease; font-size: 0.9rem;">
                                    {{ num }}
                                </a>
                            </li>
                        {% endif %}
                    {% endfor %}

                    {% if page_obj.has_next %}
                    <li class="page-item">
                        <a class="page-link" href="#" onclick="navigateToPage({{ page_obj.next_page_number }}, event)" style="border: 2px solid #e9ecef; border-radius: 8px; padding: 0.6rem 1.2rem; margin: 0 0.2rem; color: #666; font-weight: 500; transition: all 0.3s ease; font-size: 0.9rem;">
                            Вперед<i class="fas fa-chevron-right ms-2"></i>
                        </a>
                    </li>
                    {% endif %}
                </ul>
            </nav>
        </div>
        {% endif %}
    </div>
</section>

<style>
/* Animation for decorative elements */
@keyframes float {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-8px); }
}

/* Hover effects */
.stat-card:hover,
.vacancy-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 10px 25px rgba(0,0,0,0.12);
}

.filter-btn:hover,
.category-btn:hover,
.btn-details:hover,
.btn-reset:hover,
.page-link:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

.btn-search:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 15px rgba(76, 175, 80, 0.25);
}

.clear-all-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(220, 53, 69, 0.25);
}

/* Form input focus effects */
.form-control:focus {
    border-color: #4caf50 !important;
    box-shadow: 0 0 0 0.2rem rgba(76, 175, 80, 0.25) !important;
    transform: translateY(-2px);
}

/* Custom dropdown styles */
.custom-dropdown {
    position: relative;
    display: inline-block;
}

.custom-dropdown-menu {
    display: none;
    position: absolute;
    top: 100%;
    left: 0;
    min-width: 220px;
    background: white;
    border: 1px solid #dee2e6;
    border-radius: 10px;
    box-shadow: 0 8px 25px rgba(0,0,0,0.12);
    z-index: 1050;
    max-height: 250px;
    overflow-y: auto;
    margin-top: 5px;
    padding: 6px 0;
}

.custom-dropdown-menu.show {
    display: block;
    animation: fadeIn 0.2s ease-in-out;
}

.checkbox-item {
    display: flex;
    align-items: center;
    padding: 8px 14px;
    color: #212529;
    text-decoration: none;
    border: none;
    background: none;
    width: 100%;
    text-align: left;
    cursor: pointer;
    transition: background-color 0.2s;
    margin: 0;
    position: relative;
    padding-left: 40px;
    font-size: 0.9rem;
}

.checkbox-item:hover {
    background-color: #f8f9fa;
}

.checkbox-item input {
    position: absolute;
    opacity: 0;
    cursor: pointer;
    height: 0;
    width: 0;
}

.checkmark {
    position: absolute;
    top: 50%;
    left: 14px;
    transform: translateY(-50%);
    height: 18px;
    width: 18px;
    background-color: #eee;
    border-radius: 5px;
    transition: all 0.2s;
}

.checkbox-item:hover input ~ .checkmark {
    background-color: #ccc;
}

.checkbox-item input:checked ~ .checkmark {
    background-color: #4caf50;
}

.checkmark:after {
    content: "";
    position: absolute;
    display: none;
}

.checkbox-item input:checked ~ .checkmark:after {
    display: block;
}

.checkbox-item .checkmark:after {
    left: 5px;
    top: 1px;
    width: 5px;
    height: 9px;
    border: solid white;
    border-width: 0 2px 2px 0;
    transform: rotate(45deg);
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(-8px); }
    to { opacity: 1; transform: translateY(0); }
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .hero-title {
        font-size: 1.8rem !important;
    }

    .hero-subtitle {
        font-size: 1rem !important;
    }

    .filter-buttons {
        flex-direction: column;
        width: 100%;
    }

    .filter-btn {
        width: 100%;
        justify-content: center;
    }

    .categories-container {
        flex-direction: column;
    }

    .category-btn {
        width: 100%;
        justify-content: center;
    }

    .vacancy-card {
        padding: 1.2rem !important;
    }

    .vacancy-actions {
        text-align: left !important;
        margin-top: 1rem;
    }

    .btn-details {
        width: 100%;
        justify-content: center;
    }

    .stat-card {
        padding: 1.2rem !important;
    }

    .filters-card {
        padding: 1.5rem !important;
    }
}

@media (max-width: 576px) {
    .filters-card {
        padding: 1.2rem !important;
    }

    .search-form .input-group {
        flex-direction: column;
    }

    .btn-search {
        margin-left: 0 !important;
        margin-top: 0.8rem;
        width: 100%;
    }

    .pagination {
        flex-wrap: wrap;
    }

    .page-link {
        margin: 0.2rem !important;
        padding: 0.5rem 1rem !important;
    }

    .custom-dropdown-menu {
        min-width: 200px;
        left: 50%;
        transform: translateX(-50%);
    }
}

/* Scrollbar styling for dropdown */
.custom-dropdown-menu::-webkit-scrollbar {
    width: 6px;
}

.custom-dropdown-menu::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 3px;
}

.custom-dropdown-menu::-webkit-scrollbar-thumb {
    background: #c1c1c1;
    border-radius: 3px;
}

.custom-dropdown-menu::-webkit-scrollbar-thumb:hover {
    background: #a8a8a8;
}
</style>

<script>
// Текущие выбранные категории
let selectedCategories = new Set([{% for cat in selected_categories %}{{ cat }},{% endfor %}]);

// Функция для проверки и очистки поискового запроса
function cleanQuery(query) {
    if (!query || query === 'None' || query.trim() === '') {
        return null;
    }
    return query.trim();
}

// Функция для обновления URL с текущими параметрами
function updateURL(params = {}) {
    const urlParams = new URLSearchParams();

    // Добавляем выбранные категории
    selectedCategories.forEach(cat => {
        urlParams.append('category', cat);
    });

    // Обрабатываем тип фильтра
    if (params.type !== undefined) {
        if (params.type === 'all') {
            urlParams.delete('type');
        } else {
            urlParams.set('type', params.type);
        }
    } else if ('{{ filter_type }}' !== 'all') {
        urlParams.set('type', '{{ filter_type }}');
    }

    // Обрабатываем поисковый запрос
    if (params.q !== undefined) {
        const cleanQ = cleanQuery(params.q);
        if (cleanQ) {
            urlParams.set('q', cleanQ);
        } else {
            urlParams.delete('q');
        }
    } else {
        const currentQuery = cleanQuery('{{ query }}');
        if (currentQuery) {
            urlParams.set('q', currentQuery);
        }
    }

    // Удаляем параметр page при изменении фильтров (кроме случаев, когда явно передана страница)
    if (!params.page) {
        urlParams.delete('page');
    } else {
        urlParams.set('page', params.page);
    }

    // Обновляем URL
    const newUrl = `${window.location.pathname}?${urlParams.toString()}`;
    window.location.href = newUrl;
}

// Функция для обновления фильтра по типу
function updateTypeFilter(type) {
    updateURL({ type: type });
}

// Функция для обновления фильтра по категории
function updateCategoryFilter(checkbox) {
    const categoryId = checkbox.value;

    if (checkbox.checked) {
        selectedCategories.add(categoryId);
    } else {
        selectedCategories.delete(categoryId);
    }

    updateURL();
}

// Функция для удаления категории
function removeCategory(categoryId, event) {
    if (event) event.preventDefault();
    selectedCategories.delete(categoryId.toString());
    updateURL();
}

// Функция для очистки всех категорий
function clearAllCategories() {
    selectedCategories.clear();
    updateURL();
}

// Функция для удаления поискового запроса
function removeSearch(event) {
    if (event) event.preventDefault();
    updateURL({ q: '' });
}

// Функция для удаления фильтра по типу
function removeTypeFilter(event) {
    if (event) event.preventDefault();
    updateURL({ type: 'all' });
}

// Функция для навигации по страницам
function navigateToPage(page, event) {
    if (event) event.preventDefault();
    updateURL({ page: page });
}

// Функция для переключения выпадающего меню
function toggleDropdown(button) {
    const dropdown = button.nextElementSibling;
    const isOpen = dropdown.classList.contains('show');

    // Закрываем все открытые выпадающие меню
    document.querySelectorAll('.custom-dropdown-menu.show').forEach(menu => {
        menu.classList.remove('show');
    });

    // Открываем текущее, если оно было закрыто
    if (!isOpen) {
        dropdown.classList.add('show');
    }
}

// Обработка отправки формы поиска
document.addEventListener('DOMContentLoaded', function() {
    const searchForm = document.getElementById('searchForm');
    const searchInput = document.getElementById('searchInput');

    if (searchForm) {
        searchForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const query = searchInput.value.trim();
            updateURL({ q: query });
        });
    }

    // Обработка нажатия клавиши Enter в поле поиска
    if (searchInput) {
        searchInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                const query = this.value.trim();
                updateURL({ q: query });
            }
        });
    }

    // Закрытие выпадающих меню при клике вне их
    document.addEventListener('click', function(event) {
        if (!event.target.closest('.custom-dropdown')) {
            document.querySelectorAll('.custom-dropdown-menu.show').forEach(menu => {
                menu.classList.remove('show');
            });
        }
    });

    // Добавляем анимацию для карточек
    const cards = document.querySelectorAll('.stat-card, .vacancy-card');
    cards.forEach((card, index) => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(20px)';
        card.style.animation = `fadeInUp 0.6s ease-out ${0.3 + index * 0.1}s forwards`;
    });
});

// Добавляем CSS анимацию
const style = document.createElement('style');
style.textContent = `
    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
`;
document.head.appendChild(style);
</script>
{% endblock %}