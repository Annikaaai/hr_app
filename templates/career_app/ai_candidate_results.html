{% extends 'base.html' %}

{% block content %}
<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤</h2>
        <a href="{% url 'ai_search_dashboard' %}" class="btn btn-outline-secondary">‚Üê –ù–∞–∑–∞–¥ –∫ –ø–æ–∏—Å–∫—É</a>
    </div>

    <div class="card mb-4">
        <div class="card-body">
            <h5 class="card-title">{{ profile.title }}</h5>
            <p class="card-text"><strong>–ò–¥–µ–∞–ª—å–Ω–æ–µ —Ä–µ–∑—é–º–µ:</strong> {{ profile.ideal_resume|truncatewords:30 }}</p>
            <p class="card-text">
                <small class="text-muted">
                    –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ: {{ profile.min_match_percentage }}% |
                    –ù–∞–π–¥–µ–Ω–æ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤: {{ matches|length }}
                </small>
            </p>
        </div>
    </div>

    {% if matches %}
    <div class="row">
        {% for match in matches %}
        <div class="col-md-6 mb-3">
            <div class="card h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <h5 class="card-title">{{ match.matched_applicant.first_name }} {{ match.matched_applicant.last_name }}</h5>
                        <span class="badge bg-success fs-6">{{ match.match_percentage }}%</span>
                    </div>

                    {% if match.matched_applicant.resume_text %}
                    <p class="card-text">{{ match.matched_applicant.resume_text|truncatewords:20 }}</p>
                    {% endif %}

                    {% if match.match_details.matched_concepts %}
                    <p class="card-text">
                        <small class="text-muted">
                            <strong>–°–æ–≤–ø–∞–¥–µ–Ω–∏—è:</strong>
                            {{ match.match_details.matched_concepts|join:", " }}
                        </small>
                    </p>
                    {% endif %}

                    {% if match.match_details.explanation %}
                    <p class="card-text">
                        <small>{{ match.match_details.explanation }}</small>
                    </p>
                    {% endif %}
                </div>
                <div class="card-footer">
                    <div class="d-grid gap-2">
                        <a href="{% url 'send_offer_to_candidate' match.id %}" class="btn btn-primary btn-sm">
                            üì® –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ
                        </a>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="alert alert-info">
        <h5>–ö–∞–Ω–¥–∏–¥–∞—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h5>
        <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –∫—Ä–∏—Ç–µ—Ä–∏–∏ –ø–æ–∏—Å–∫–∞ –∏–ª–∏ —É–º–µ–Ω—å—à–∏—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ü–µ–Ω—Ç —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è.</p>
        <a href="{% url 'create_ideal_candidate_profile' %}" class="btn btn-outline-primary">
            –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–∏—Å–∫–∞
        </a>
    </div>
    {% endif %}
</div>
{% endblock %}