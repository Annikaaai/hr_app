{% extends 'base.html' %}

{% block content %}
<div class="container mt-4">
    <h2>–£–º–Ω—ã–π –ø–æ–∏—Å–∫ —Å –ò–ò</h2>

    <div class="row">
        <div class="col-md-8">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">–ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫</h5>

                    {% if user.userprofile.role == 'hr' %}
                    <a href="{% url 'create_ideal_candidate_profile' %}" class="btn btn-primary mb-3">
                        –°–æ–∑–¥–∞—Ç—å –∏–¥–µ–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å –∫–∞–Ω–¥–∏–¥–∞—Ç–∞
                    </a>
                    <p class="text-muted">
                        –û–ø–∏—à–∏—Ç–µ –∏–¥–µ–∞–ª—å–Ω–æ–≥–æ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞, –∏ –ò–ò –Ω–∞–π–¥–µ—Ç –ª—É—á—à–∏—Ö —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π –∏–∑ –±–∞–∑—ã —Ä–µ–∑—é–º–µ
                    </p>
                    {% elif user.userprofile.role == 'applicant' %}
                    <a href="{% url 'create_ideal_vacancy_profile' %}" class="btn btn-primary mb-3">
                        –°–æ–∑–¥–∞—Ç—å –∏–¥–µ–∞–ª—å–Ω—É—é –≤–∞–∫–∞–Ω—Å–∏—é
                    </a>
                    <p class="text-muted">
                        –û–ø–∏—à–∏—Ç–µ –∏–¥–µ–∞–ª—å–Ω—É—é —Ä–∞–±–æ—Ç—É, –∏ –ò–ò –Ω–∞–π–¥–µ—Ç –ª—É—á—à–∏–µ –≤–∞–∫–∞–Ω—Å–∏–∏ –¥–ª—è –≤–∞—Å
                    </p>
                    {% endif %}
                </div>
            </div>

            {% if recent_matches %}
            <div class="card mt-4">
                <div class="card-body">
                    <h5 class="card-title">–ü–æ—Å–ª–µ–¥–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</h5>
                    {% for match in recent_matches %}
                    <div class="border-bottom pb-2 mb-2">
                        <div class="d-flex justify-content-between">
                            <div>
                                {% if match.matched_applicant %}
                                <strong>{{ match.matched_applicant.first_name }} {{ match.matched_applicant.last_name }}</strong>
                                <span class="badge bg-success ms-2">{{ match.match_percentage }}%</span>
                                {% elif match.matched_vacancy %}
                                <strong>{{ match.matched_vacancy.title }}</strong>
                                <span class="badge bg-success ms-2">{{ match.match_percentage }}%</span>
                                {% endif %}
                            </div>
                            <small class="text-muted">{{ match.created_at|date:"d.m.Y" }}</small>
                        </div>
                        {% if match.matched_applicant %}
                        <a href="{% url 'send_offer_to_candidate' match.id %}" class="btn btn-sm btn-outline-primary mt-1">
                            –û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ñ–µ—Ä
                        </a>
                        {% elif match.matched_vacancy %}
                        <a href="{% url 'vacancy_detail' match.matched_vacancy.id %}" class="btn btn-sm btn-outline-primary mt-1">
                            –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤–∞–∫–∞–Ω—Å–∏—é
                        </a>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
        </div>

        <div class="col-md-4">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">–ú–æ–∏ –ø—Ä–æ—Ñ–∏–ª–∏ –ø–æ–∏—Å–∫–∞</h5>

                    {% if user.userprofile.role == 'hr' %}
                        <!-- –ü—Ä–æ—Ñ–∏–ª–∏ –¥–ª—è HR -->
                        {% for profile in profiles %}
                        <div class="card mb-3">
                            <div class="card-body">
                                <h6 class="card-title">{{ profile.title }}</h6>
                                <p class="card-text small">
                                    –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π %: {{ profile.min_match_percentage }}%<br>
                                    –ö–∞–Ω–¥–∏–¥–∞—Ç–æ–≤: {{ profile.max_candidates }}
                                </p>
                                <div class="btn-group w-100">
                                    <a href="{% url 'ai_search_results' profile.id %}" class="btn btn-sm btn-outline-primary">
                                        –†–µ–∑—É–ª—å—Ç–∞—Ç—ã
                                    </a>
                                    <a href="{% url 'run_ai_search' profile.id %}" class="btn btn-sm btn-primary">
                                        üîç –ü–æ–∏—Å–∫
                                    </a>
                                    <a href="{% url 'edit_ideal_candidate_profile' profile.id %}" class="btn btn-sm btn-outline-secondary">
                                        ‚úèÔ∏è
                                    </a>
                                </div>
                            </div>
                        </div>
                        {% empty %}
                        <div class="alert alert-info">
                            <small>–£ –≤–∞—Å –µ—â–µ –Ω–µ—Ç –ø—Ä–æ—Ñ–∏–ª–µ–π –¥–ª—è –ø–æ–∏—Å–∫–∞ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤.</small>
                        </div>
                        {% endfor %}

                    {% elif user.userprofile.role == 'applicant' %}
                        <!-- –ü—Ä–æ—Ñ–∏–ª–∏ –¥–ª—è —Å–æ–∏—Å–∫–∞—Ç–µ–ª–µ–π -->
                        {% for profile in profiles %}
                        <div class="card mb-3">
                            <div class="card-body">
                                <h6 class="card-title">{{ profile.title }}</h6>
                                <p class="card-text small">
                                    –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π %: {{ profile.min_match_percentage }}%<br>
                                    –í–∞–∫–∞–Ω—Å–∏–π: {{ profile.max_vacancies }}
                                </p>
                                <div class="btn-group w-100">
                                    <a href="{% url 'ai_search_results' profile.id %}" class="btn btn-sm btn-outline-primary">
                                        –†–µ–∑—É–ª—å—Ç–∞—Ç—ã
                                    </a>
                                    <a href="{% url 'run_ai_search' profile.id %}" class="btn btn-sm btn-primary">
                                        üîç –ü–æ–∏—Å–∫
                                    </a>
                                    <a href="{% url 'edit_ideal_vacancy_profile' profile.id %}" class="btn btn-sm btn-outline-secondary">
                                        ‚úèÔ∏è
                                    </a>
                                </div>
                            </div>
                        </div>
                        {% empty %}
                        <div class="alert alert-info">
                            <small>–£ –≤–∞—Å –µ—â–µ –Ω–µ—Ç –ø—Ä–æ—Ñ–∏–ª–µ–π –¥–ª—è –ø–æ–∏—Å–∫–∞ –≤–∞–∫–∞–Ω—Å–∏–π.</small>
                        </div>
                        {% endfor %}
                    {% endif %}

                    <!-- –ö–Ω–æ–ø–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è -->
                    <div class="mt-3">
                        {% if user.userprofile.role == 'hr' %}
                        <a href="{% url 'create_ideal_candidate_profile' %}" class="btn btn-success btn-sm w-100">
                            ‚ûï –ù–æ–≤—ã–π –ø—Ä–æ—Ñ–∏–ª—å –∫–∞–Ω–¥–∏–¥–∞—Ç–∞
                        </a>
                        {% elif user.userprofile.role == 'applicant' %}
                        <a href="{% url 'create_ideal_vacancy_profile' %}" class="btn btn-success btn-sm w-100">
                            ‚ûï –ù–æ–≤—ã–π –ø—Ä–æ—Ñ–∏–ª—å –≤–∞–∫–∞–Ω—Å–∏–∏
                        </a>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
            <div class="card mt-3">
                <div class="card-body">
                    <h6 class="card-title">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–∏—Å–∫–∞</h6>
                    <div class="small">
                        {% if user.userprofile.role == 'hr' %}
                        <p>–í—Å–µ–≥–æ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ –≤ –±–∞–∑–µ: <strong>{{ total_applicants|default:0 }}</strong></p>
                        <p>–í–∞—à–∏—Ö –ø—Ä–æ—Ñ–∏–ª–µ–π: <strong>{{ profiles|length }}</strong></p>
                        {% elif user.userprofile.role == 'applicant' %}
                        <p>–í—Å–µ–≥–æ –≤–∞–∫–∞–Ω—Å–∏–π: <strong>{{ total_vacancies|default:0 }}</strong></p>
                        <p>–í–∞—à–∏—Ö –ø—Ä–æ—Ñ–∏–ª–µ–π: <strong>{{ profiles|length }}</strong></p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}